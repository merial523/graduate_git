{% extends base_template %}
{% load static %}

{% block content %}
<div class="dashboard-wrapper">
    
    <div class="hero-header text-white p-4">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                    <h4 class="fw-bold m-0">ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼š{{ user.username }}</h4>
            </div>
            <div class="today-date bg-white text-success rounded-3 px-3 py-1 fw-bold shadow-sm text-center">
                <span class="small d-block text-muted" style="font-size: 10px;">TODAY</span>
                <span id="current-date">--/--</span>
            </div>
        </div>
        
        <div class="goal-widget bg-white text-dark bg-opacity-20 rounded-3 p-3 mt-3 backdrop-blur border border-white border-opacity-25">
            <div class="d-flex align-items-center mb-1">
                <span class="material-icons size-18 me-1">flag</span>
                <span class="small fw-bold">ä»Šæœˆã®ç›®æ¨™</span>
            </div>
            <p class="m-0 small text-dark">ã€Œæ¥é‡ã‚¹ã‚­ãƒ«ã€ã‚’å¼·åŒ–ã—ã¦ã€ãƒãƒƒã‚¸ã‚’1ã¤ç²å¾—ã—ã‚ˆã†ï¼</p>
        </div>
    </div>

    <div class="content-body px-3 pb-5" style="margin-top: -30px;">

        <div class="row g-3 mb-4">
            <div class="col-6 col-sm-6">
                <div class="stat-card bg-white p-4 rounded-4 shadow-sm h-100 text-center position-relative overflow-hidden">
                    <div class="stat-icon-bg bg-success opacity-10"></div>
                    <span class="material-icons text-success mb-2" style="font-size: 40px;">school</span>
                    <div class="small text-muted fw-bold mb-1">å®Œäº†ã‚³ãƒ¼ã‚¹</div>
                    <div class="h3 fw-900 text-dark m-0">{{ completed_course_count }}<span class="fs-6 fw-normal text-muted ms-1">ä»¶</span></div>
                </div>
            </div>
            <div class="col-6 col-sm-6">
                <div class="stat-card bg-white p-4 rounded-4 shadow-sm h-100 text-center position-relative overflow-hidden">
                    <div class="stat-icon-bg bg-warning opacity-10"></div>
                    <span class="material-icons text-warning mb-2" style="font-size: 40px;">military_tech</span>
                    <div class="small text-muted fw-bold mb-1">ç²å¾—ãƒãƒƒã‚¸</div>
                    <div class="h3 fw-900 text-dark m-0">{{ badges_count }}<span class="fs-6 fw-normal text-muted ms-1">å€‹</span></div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-12 col-md-6">
                <div class="section-header d-flex justify-content-between align-items-center mb-2 px-1">
                    <h6 class="fw-bold m-0 text-dark"><span class="text-success me-2">â—</span>ãŠçŸ¥ã‚‰ã›</h6>
                    <a href="{% url 'staff:news_list' %}" class="text-decoration-none extra-small text-muted">ã‚‚ã£ã¨è¦‹ã‚‹</a>
                </div>
                <div class="bg-white rounded-4 shadow-sm p-4 h-100">
                    {% for news in latest_news %}
                    <div class="news-item border-bottom pb-3 mb-3 last-no-border">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="badge bg-success-subtle text-success border border-success-subtle extra-small">News</span>
                            <span class="extra-small text-muted">{{ news.created_at|date:"m/d" }}</span>
                        </div>
                        <a href="#" class="text-dark text-decoration-none fw-bold small line-clamp-1 hover-text-success">
                            {{ news.title }}
                        </a>
                    </div>
                    {% empty %}
                    <div class="text-center py-4 text-muted small">ç¾åœ¨ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ ğŸ±</div>
                    {% endfor %}
                </div>
            </div>

            <div class="col-12 col-md-6">
                <div class="section-header d-flex justify-content-between align-items-center mb-2 px-1">
                    <h6 class="fw-bold m-0 text-dark"><span class="text-warning me-2">â—</span>ç§°å·ç²å¾—ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h6>
                </div>
                <div class="bg-white rounded-4 shadow-sm p-4 text-center ranking-container h-100">
                    <div class="d-flex justify-content-center align-items-end gap-3 py-3">
                        {% for rank_user in badge_ranking %}
                            <div class="ranking-user {% if forloop.counter == 1 %}order-2 rank-1{% elif forloop.counter == 2 %}order-1 rank-2{% else %}order-3 rank-3{% endif %}">
                                <div class="position-relative d-inline-block">
                                    <div class="avatar-circle shadow-sm overflow-hidden">
                                {% if forloop.counter == 1 %}
                                    <span class="crown">ğŸ‘‘</span>
                                {% endif %}

                                {% if rank_user.profile_image %}
                                    <img src="{{ rank_user.profile_image.url }}" alt="{{ rank_user.username }}" class="w-100 h-100 object-fit-cover">
                                {% else %}
                                    <span class="initials">{{ rank_user.username|slice:":1" }}</span>
                                {% endif %}
                            </div>
                                    <span class="rank-badge badge rounded-pill border shadow-sm">
                                        {{ forloop.counter }}
                                    </span>
                                </div>
                                <div class="mt-2">
                                    <div class="fw-bold small text-truncate" style="max-width: 80px;">{{ rank_user.username }}</div>
                                    <div class="text-primary fw-900 small">{{ rank_user.badge_count }} <span class="extra-small text-muted">å€‹</span></div>
                                </div>
                            </div>
                        {% empty %}
                            <p class="text-muted small">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿é›†è¨ˆä¸­...</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
    /* ãƒ’ãƒ¼ãƒ­ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼: è§’ä¸¸ã¨ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .hero-header {
        background: linear-gradient(135deg, #76b19d 0%, #5a9e88 100%);
        border-radius: 20px; /* base.htmlã®å†…å´ã§æµ®ãã‚ˆã†ã«å°‘ã—ä¸¸ã‚ã‚‹ */
        padding-bottom: 60px !important;
        margin-bottom: 20px;
    }

    .backdrop-blur { backdrop-filter: blur(5px); }

    /* ã‚¹ã‚¿ãƒƒãƒ„ã‚«ãƒ¼ãƒ‰: ã‚†ã¨ã‚Šã‚’æŒãŸã›ã‚‹ */
    .stat-card {
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid rgba(0,0,0,0.03);
    }
    .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05) !important; }
    .stat-icon-bg {
        position: absolute;
        top: -10px; right: -10px;
        width: 80px; height: 80px;
        border-radius: 50%;
    }
    .fw-900 { font-weight: 900; }

    /* ãŠçŸ¥ã‚‰ã› */
    .last-no-border:last-child { border-bottom: none !important; margin-bottom: 0 !important; padding-bottom: 0 !important; }
    .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
    .hover-text-success:hover { color: #76b19d !important; }

    /* ãƒ©ãƒ³ã‚­ãƒ³ã‚° */
    .ranking-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        background-color: #fcfdfe !important;
    }
    .avatar-circle {
        width: 60px; height: 60px;
        background: #fff; border: 3px solid #fff;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-weight: bold; color: #555; font-size: 1.2rem;
        background-color: #f0f0f0;
    }
    .rank-1 .avatar-circle { width: 85px; height: 85px; border-color: #ffd700; background-color: #fff9db; color: #d6a600;}
    .rank-1 .rank-badge { background: #ffd700; color: #fff; border-color: #ffd700; }
    .rank-2 .rank-badge { background: #c0c0c0; color: #fff; border-color: #c0c0c0; }
    .rank-3 .rank-badge { background: #cd7f32; color: #fff; border-color: #cd7f32; }
    
    .rank-badge {
        position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
        font-size: 0.75rem; padding: 3px 10px;
    }
    .crown {
        position: absolute; top: -22px; left: 50%; transform: translateX(-50%) rotate(-10deg);
        font-size: 1.8rem;
        z-index: 10;
    }

    .extra-small { font-size: 0.75rem; }
    .size-18 { font-size: 18px; vertical-align: middle; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const now = new Date();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const day = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][now.getDay()];
        const target = document.getElementById('current-date');
        if (target) {
            target.innerText = `${month}/${date}(${day})`;
        }
    });
</script>
{% endblock %}