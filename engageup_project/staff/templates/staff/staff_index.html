{% extends base_template %} 

{% block title %}ãƒ›ãƒ¼ãƒ  | EngageUp{% endblock %}

{% block content %}
<div class="user-management-container pb-5">
    
    <!-- 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚¨ãƒªã‚¢ -->
    <div class="welcome-banner mb-4 shadow-sm border-0 bg-white">
        <div class="d-flex align-items-center">
            <div class="avatar-wrapper-home">
                {% if request.user.avatar %}
                    <img src="{{ request.user.avatar.url }}" class="rounded-circle shadow-sm" style="width: 70px; height: 70px; object-fit: cover; border: 3px solid white;">
                {% else %}
                    <div class="rounded-circle shadow-sm d-flex align-items-center justify-content-center bg-soft-green text-primary" style="width: 70px; height: 70px; font-size: 2rem;">
                        <span class="material-icons">person</span>
                    </div>
                {% endif %}
            </div>
            <div class="ms-3">
                <h2 class="greeting-text text-dark">
                    {% if user.is_authenticated %}{{ user.username }}{% else %}ã‚²ã‚¹ãƒˆ{% endif %}ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼
                </h2>
                <p class="text-muted small mb-0">ä»Šæ—¥ã‚‚æ¥½ã—ãå­¦ç¿’ã‚’é€²ã‚ã¾ã—ã‚‡ã† ğŸ±</p>
            </div>
        </div>
    </div>

    <!-- 2. å­¦ç¿’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆã‚¯ã‚¤ãƒƒã‚¯çµ±è¨ˆï¼‰ -->
    <div class="row g-3 mb-4">
        <div class="col-6">
            <div class="stat-card-home bg-white border-0 shadow-sm">
                <span class="material-icons text-primary opacity-50 mb-1">auto_stories</span>
                <p class="stat-label">å®Œäº†ã—ãŸã‚³ãƒ¼ã‚¹</p>
                <p class="stat-value text-primary">{{ completed_course_count|default:"0" }}<small>ä»¶</small></p>
            </div>
        </div>
        <div class="col-6">
            <div class="stat-card-home bg-white border-0 shadow-sm">
                <span class="material-icons text-orange opacity-50 mb-1">military_tech</span>
                <p class="stat-label">æ‰€æŒãƒãƒƒã‚¸</p>
                <p class="stat-value text-orange">{{ badges_count|default:"0" }}<small>å€‹</small></p>
            </div>
        </div>
    </div>

    <!-- 3. ãƒãƒƒã‚¸å–å¾—ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
    <div class="admin-card border-0 shadow-sm mb-4 overflow-hidden bg-white">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="page-title m-0">ğŸ† ãƒãƒƒã‚¸å–å¾—ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
        </div>

        <div class="ranking-container">
            {% if badge_ranking %}
                <div class="ranking-visual-grid mb-4">
                    {% for ranked_user in badge_ranking %}
                        {% if forloop.counter <= 3 %}
                            {# ä¸Šä½3åã¯ç‰¹åˆ¥ãªã‚«ãƒ¼ãƒ‰å½¢å¼ #}
                            <div class="rank-top-card rank-{{ forloop.counter }} shadow-sm">
                                <div class="rank-number">
                                    {% if forloop.counter == 1 %}ğŸ¥‡{% elif forloop.counter == 2 %}ğŸ¥ˆ{% else %}ğŸ¥‰{% endif %}
                                </div>
                                <div class="rank-avatar">
                                    {% if ranked_user.avatar %}
                                        <img src="{{ ranked_user.avatar.url }}" class="rounded-circle">
                                    {% else %}
                                        <span class="material-icons">account_circle</span>
                                    {% endif %}
                                </div>
                                <div class="rank-info text-center">
                                    <p class="username fw-bold text-dark text-truncate mb-0">{{ ranked_user.username }}</p>
                                    <p class="badge-count fw-800 text-primary mb-0">{{ ranked_user.badge_count }}<small>å€‹</small></p>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                {# 4ä½ä»¥é™ã‚’ãƒªã‚¹ãƒˆè¡¨ç¤º #}
                <div class="ranking-sub-list">
                    {% for ranked_user in badge_ranking %}
                        {% if forloop.counter > 3 %}
                            <div class="ranking-list-item d-flex align-items-center py-2 px-3 mb-2 rounded-3 bg-light border-0">
                                <span class="rank-num text-muted fw-bold me-3">{{ forloop.counter }}</span>
                                <span class="username flex-grow-1 text-dark small fw-bold">{{ ranked_user.username }}</span>
                                <span class="badge-count text-muted small fw-800">{{ ranked_user.badge_count }}å€‹</span>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-5 text-muted bg-light rounded-4">
                    <span class="material-icons opacity-25 fs-1">emoji_events</span>
                    <p class="mb-0 mt-2">ãƒ©ãƒ³ã‚­ãƒ³ã‚°é›†è¨ˆä¸­ã§ã™...</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- 4. é€šçŸ¥ ï¼† ãƒã‚¤ãƒªã‚¹ãƒˆ -->
    <div class="row g-3">
        <div class="col-12">
            <a href="#" class="admin-card border-0 shadow-sm d-flex align-items-center justify-content-between text-decoration-none bg-white p-3">
                <div class="d-flex align-items-center gap-3">
                    <div class="icon-circle bg-soft-orange text-orange">
                        <span class="material-icons">notifications_active</span>
                    </div>
                    <div>
                        <h2 class="h6 fw-bold text-dark mb-0">å¾©ç¿’ãŒå¿…è¦ãªæ¤œå®š</h2>
                        <p class="text-muted extra-small mb-0">ãƒ“ã‚¸ãƒã‚¹ãƒãƒŠãƒ¼åŸºç¤ï¼ˆæ®‹ã‚Š3æ—¥ï¼‰</p>
                    </div>
                </div>
                <span class="material-icons text-muted">chevron_right</span>
            </a>
        </div>

        <div class="col-12">
            <a href="#" class="admin-card border-0 shadow-sm d-flex align-items-center justify-content-between text-decoration-none bg-white p-3">
                <div class="d-flex align-items-center gap-3">
                    <div class="icon-circle bg-soft-green text-green">
                        <span class="material-icons">bookmark_added</span>
                    </div>
                    <div>
                        <h2 class="h6 fw-bold text-dark mb-0">ãƒã‚¤ãƒªã‚¹ãƒˆ</h2>
                        <p class="text-muted extra-small mb-0">ä¿å­˜ã—ãŸå‹•ç”»ã‚„ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒã‚§ãƒƒã‚¯</p>
                    </div>
                </div>
                <span class="material-icons text-muted">chevron_right</span>
            </a>
        </div>
    </div>
</div>

<style>
/* --- ãƒ›ãƒ¼ãƒ å°‚ç”¨è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« --- */
.fw-800 { font-weight: 800 !important; }
.extra-small { font-size: 0.72rem; }
.bg-soft-green { background-color: #e8f5f1; }
.bg-soft-orange { background-color: #fff4f0; }
.text-orange { color: var(--accent-color); }
.text-green { color: var(--primary-color); }

.page-title {
    font-size: 1.4rem;
    border-left: 5px solid var(--primary-color);
    padding-left: 15px;
    font-weight: 800;
}

/* ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒãƒŠãƒ¼ */
.welcome-banner {
    border-radius: 32px;
    padding: 24px;
}
.greeting-text { font-size: 1.3rem; letter-spacing: -0.5px; }

/* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
.stat-card-home {
    padding: 20px;
    border-radius: 28px;
    text-align: center;
}
.stat-label { font-size: 0.75rem; font-weight: 800; color: #999; margin-bottom: 2px; }
.stat-value { font-size: 1.8rem; font-weight: 900; margin: 0; }

/* ãƒ©ãƒ³ã‚­ãƒ³ã‚° ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ« */
.ranking-visual-grid {
    display: grid;
    grid-template-columns: 1fr 1.2fr 1fr; /* 1ä½ã‚’å°‘ã—å¤§ãã */
    gap: 12px;
    align-items: flex-end;
}
.rank-top-card {
    background: #fff;
    border-radius: 24px;
    padding: 15px 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    border: 2px solid transparent;
}
.rank-1 { border-color: #FFD700; background: #fffdf0; order: 2; }
.rank-2 { order: 1; }
.rank-3 { order: 3; }

.rank-number { font-size: 1.5rem; margin-bottom: 8px; }
.rank-avatar img, .rank-avatar span {
    width: 50px; height: 50px; border-radius: 50%; object-fit: cover;
    margin-bottom: 8px; font-size: 50px; color: #ccc;
}
.rank-1 .rank-avatar img { width: 65px; height: 65px; border: 3px solid #FFD700; }

/* ä¸‹éƒ¨ãƒªãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ */
.icon-circle {
    width: 45px; height: 45px; border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.admin-card { transition: transform 0.3s ease; }
.admin-card:hover { transform: translateY(-3px); }
</style>
{% endblock %}