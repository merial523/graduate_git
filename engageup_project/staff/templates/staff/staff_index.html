{% extends base_template %} 

{% block title %}„Éõ„Éº„É† | EngageUp{% endblock %}

{% block content %}
<div class="user-management-container pb-5">
    
    <!-- 1. „Éó„É¨„Éü„Ç¢„É†„Éª„Ç¶„Çß„É´„Ç´„É†„Ç®„É™„Ç¢Ôºà„É¶„Éº„Ç∂„Éº„ÅÆÂ≠òÂú®ÊÑü„ÇíÂº∑Ë™øÔºâ -->
    <div class="welcome-section mb-4 overflow-hidden position-relative">
        <div class="welcome-card p-4 d-flex align-items-center">
            <div class="avatar-container position-relative">
                {% if request.user.avatar %}
                    <img src="{{ request.user.avatar.url }}" class="home-avatar shadow-lg">
                {% else %}
                    <div class="home-avatar-placeholder shadow-lg">
                        <span class="material-icons">pets</span>
                    </div>
                {% endif %}
                <div class="rank-badge-overlay">Staff</div>
            </div>
            <div class="ms-4 text-white">
                <h2 class="greeting-text mb-1 fw-800">
                    {{ user.username }}„Åï„Çì„ÄÅ<br class="d-md-none">„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑÔºÅ
                </h2>
                <p class="mb-0 extra-small opacity-75">
                    <span class="material-icons size-14 align-middle">verified</span>
                    ‰ªäÊó•„ÇÇ‰∏ÄÊ≠©„Åö„Å§„ÄÅÊàêÈï∑„ÇíÊ•Ω„Åó„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ
                </p>
            </div>
        </div>
        <!-- Ë£ÖÈ£æÁî®„Ç¢„Ç§„Ç≥„É≥ -->
        <span class="material-icons deco-icon">auto_awesome</span>
    </div>

    <!-- 2. Â≠¶ÁøíË¶ÅÁ¥ÑÔºàÈÄ≤Êçó„Åå‰∏ÄÁõÆ„Åß„Çè„Åã„ÇãÔºâ -->
    <div class="row g-3 mb-4">
        <div class="col-6">
            <div class="stat-card-premium">
                <div class="stat-icon bg-soft-green text-green">
                    <span class="material-icons">auto_stories</span>
                </div>
                <div class="stat-content">
                    <p class="stat-label">ÂÆå‰∫Ü„Ç≥„Éº„Çπ</p>
                    <p class="stat-value">{{ completed_course_count|default:"0" }}<small>‰ª∂</small></p>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="stat-card-premium">
                <div class="stat-icon bg-soft-orange text-orange">
                    <span class="material-icons">military_tech</span>
                </div>
                <div class="stat-content">
                    <p class="stat-label">Áç≤Âæó„Éê„ÉÉ„Ç∏</p>
                    <p class="stat-value">{{ badges_count|default:"0" }}<small>ÂÄã</small></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. „Éê„ÉÉ„Ç∏ÂèñÂæó„É©„É≥„Ç≠„É≥„Ç∞ÔºàË°®ÂΩ∞Âè∞„Çπ„Çø„Ç§„É´Ôºâ -->
    <div class="admin-card border-0 shadow-sm mb-4 bg-white rounded-5">
        <div class="d-flex justify-content-between align-items-center p-4 pb-0">
            <h2 class="page-title m-0">üèÜ Áß∞Âè∑Áç≤Âæó„É©„É≥„Ç≠„É≥„Ç∞</h2>
            <span class="badge bg-light text-muted fw-normal px-3 py-2 rounded-pill">Top 5</span>
        </div>

        <div class="ranking-podium-container p-4">
            {% if badge_ranking %}
                <div class="ranking-podium mb-4">
                    {% for ranked_user in badge_ranking %}
                        {% if forloop.counter <= 3 %}
                            <div class="podium-item podium-{{ forloop.counter }}">
                                <div class="podium-user-avatar">
                                    {% if ranked_user.avatar %}
                                        <img src="{{ ranked_user.avatar.url }}">
                                    {% else %}
                                        <span class="material-icons">account_circle</span>
                                    {% endif %}
                                    <div class="podium-rank-circle">
                                        {% if forloop.counter == 1 %}1{% elif forloop.counter == 2 %}2{% else %}3{% endif %}
                                    </div>
                                </div>
                                <p class="podium-name fw-bold text-dark">{{ ranked_user.username }}</p>
                                <p class="podium-score fw-800 text-primary">{{ ranked_user.badge_count }}ÂÄã</p>
                                <div class="podium-base shadow-sm"></div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <div class="ranking-list-clean px-2">
                    {% for ranked_user in badge_ranking %}
                        {% if forloop.counter > 3 %}
                            <div class="ranking-row d-flex align-items-center p-2 mb-2 rounded-4">
                                <span class="rank-num">{{ forloop.counter }}</span>
                                <div class="mini-avatar mx-2">
                                    {% if ranked_user.avatar %}
                                        <img src="{{ ranked_user.avatar.url }}" class="rounded-circle">
                                    {% else %}
                                        <span class="material-icons">person</span>
                                    {% endif %}
                                </div>
                                <span class="username flex-grow-1 text-dark small fw-bold">{{ ranked_user.username }}</span>
                                <span class="score-mini text-muted small fw-800">{{ ranked_user.badge_count }}ÂÄã</span>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-5 text-muted">
                    <span class="material-icons opacity-25 fs-1">emoji_events</span>
                    <p class="mb-0 mt-2">„É©„É≥„Ç≠„É≥„Ç∞ÈõÜË®à‰∏≠...</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- 4. „Éû„Ç§„É™„Çπ„Éà„Éª„Éï„Ç©„É´„ÉÄÔºà„ÅäÊ∞ó„Å´ÂÖ•„Çä„Å∏„ÅÆËøëÈÅìÔºâ -->
    <div class="row g-3">
        <div class="col-12">
            <a href="{% url 'mylist:mylistIndex' %}" class="mylist-hero-card">
                <div class="card-inner p-4 shadow-sm">
                    <div class="d-flex align-items-center">
                        <div class="folder-icon-box shadow-sm">
                            <span class="material-icons">favorite</span>
                        </div>
                        <div class="ms-3 flex-grow-1">
                            <h2 class="h5 fw-800 text-dark mb-1">My List</h2>
                            <p class="text-muted extra-small mb-0">„ÅÇ„Å™„Åü„Åå„ÅäÊ∞ó„Å´ÂÖ•„ÇäÁôªÈå≤„Åó„ÅüÁ†î‰øÆ„ÇíË°®Á§∫„Åó„Åæ„Åô</p>
                        </div>
                        <div class="arrow-box">
                            <span class="material-icons">arrow_forward_ios</span>
                        </div>
                    </div>
                    <!-- „Éó„É¨„Éì„É•„ÉºÈ¢®ËÉåÊôØ„Éá„Ç≥„É¨„Éº„Ç∑„Éß„É≥ -->
                    <div class="card-deco-blobs">
                        <div class="blob-1"></div>
                        <div class="blob-2"></div>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>

<style>
/* --- ÂÖ±ÈÄö„Éª„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ --- */
.fw-800 { font-weight: 800 !important; }
.extra-small { font-size: 0.75rem; }
.size-14 { font-size: 14px; }
.bg-soft-green { background-color: #eef7f4; }
.bg-soft-orange { background-color: #fff5f0; }
.text-orange { color: #e88d6a; }
.text-green { color: #76b19d; }

.page-title {
    font-size: 1.4rem;
    border-left: 5px solid var(--primary-color);
    padding-left: 15px;
    font-weight: 800;
}

/* 1. „Ç¶„Çß„É´„Ç´„É†„Ç®„É™„Ç¢ */
.welcome-section {
    border-radius: 32px;
    background: linear-gradient(135deg, #76b19d 0%, #5da08a 100%);
    box-shadow: 0 15px 35px rgba(118, 177, 157, 0.3);
}
.home-avatar, .home-avatar-placeholder {
    width: 85px; height: 85px;
    border-radius: 30px;
    object-fit: cover;
    border: 4px solid rgba(255,255,255,0.3);
}
.home-avatar-placeholder {
    background: white; color: var(--primary-color);
    display: flex; align-items: center; justify-content: center;
    font-size: 2.5rem;
}
.rank-badge-overlay {
    position: absolute; bottom: -5px; right: -10px;
    background: var(--accent-color); color: white;
    font-size: 0.6rem; font-weight: 900;
    padding: 3px 10px; border-radius: 50px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.deco-icon {
    position: absolute; top: -10px; right: -10px;
    font-size: 100px; color: rgba(255,255,255,0.05);
    transform: rotate(15deg);
}

/* 2. Áµ±Ë®à„Ç´„Éº„Éâ */
.stat-card-premium {
    background: white; border-radius: 28px;
    padding: 20px; display: flex; align-items: center; gap: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.03);
    transition: 0.3s;
}
.stat-card-premium:hover { transform: translateY(-3px); }
.stat-icon {
    width: 44px; height: 44px; border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
}
.stat-label { font-size: 0.7rem; color: #999; font-weight: bold; margin: 0; }
.stat-value { font-size: 1.4rem; font-weight: 900; margin: 0; }

/* 3. „É©„É≥„Ç≠„É≥„Ç∞Ë°®ÂΩ∞Âè∞ */
.ranking-podium {
    display: flex; justify-content: center; align-items: flex-end;
    padding-top: 40px; gap: 10px;
}
.podium-item { display: flex; flex-direction: column; align-items: center; flex: 1; }
.podium-1 { order: 2; transform: scale(1.15); z-index: 2; }
.podium-2 { order: 1; margin-bottom: -10px; }
.podium-3 { order: 3; margin-bottom: -15px; }

.podium-user-avatar { position: relative; margin-bottom: 10px; }
.podium-user-avatar img, .podium-user-avatar span {
    width: 50px; height: 50px; border-radius: 50%; border: 3px solid white; box-shadow: 0 8px 20px rgba(0,0,0,0.1); background: white;
}
.podium-1 .podium-user-avatar img { width: 65px; height: 65px; border-color: #FFD700; }
.podium-rank-circle {
    position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
    width: 20px; height: 20px; border-radius: 50%; font-size: 0.7rem; color: white; font-weight: 900;
    display: flex; align-items: center; justify-content: center;
}
.podium-1 .podium-rank-circle { background: #FFD700; }
.podium-2 .podium-rank-circle { background: #C0C0C0; }
.podium-3 .podium-rank-circle { background: #CD7F32; }

.podium-name { font-size: 0.75rem; margin-bottom: 2px; text-align: center; max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.podium-score { font-size: 0.85rem; margin-bottom: 10px; }
.podium-base { height: 8px; width: 80%; background: #eee; border-radius: 50px; }
.podium-1 .podium-base { background: #FFD700; height: 10px; width: 100%; opacity: 0.3; }

.ranking-row { background: #fafafa; transition: 0.2s; }
.rank-num { width: 24px; font-weight: 900; color: #ccc; font-size: 0.8rem; }
.mini-avatar img { width: 30px; height: 30px; }

/* 4. „Éû„Ç§„É™„Çπ„Éà„Ç´„Éº„Éâ */
.mylist-hero-card { text-decoration: none; display: block; position: relative; transition: 0.3s; }
.mylist-hero-card .card-inner {
    background: white; border-radius: 32px;
    border: 1px solid rgba(0,0,0,0.03); overflow: hidden; position: relative;
}
.folder-icon-box {
    width: 56px; height: 56px; border-radius: 20px;
    background: var(--bg-color); color: var(--accent-color);
    display: flex; align-items: center; justify-content: center;
}
.folder-icon-box .material-icons { font-size: 32px; }
.arrow-box { color: #ddd; }
.mylist-hero-card:hover { transform: translateY(-5px); }
.mylist-hero-card:hover .card-inner { border-color: var(--primary-color); box-shadow: 0 15px 40px rgba(0,0,0,0.08); }
.mylist-hero-card:hover .arrow-box { color: var(--primary-color); transform: translateX(5px); transition: 0.3s; }

/* „Éû„Ç§„É™„Çπ„ÉàÂÜÖ blob Ë£ÖÈ£æ */
.card-deco-blobs div { position: absolute; border-radius: 50%; opacity: 0.05; z-index: 0; }
.blob-1 { width: 100px; height: 100px; background: var(--primary-color); top: -30px; right: -20px; }
.blob-2 { width: 60px; height: 60px; background: var(--accent-color); bottom: -10px; left: 150px; }
</style>
{% endblock %}