{% extends 'staff/staff_base.html' %} 

{% block title %}ãƒ›ãƒ¼ãƒ  | EngageUp{% endblock %}

{% block content %}
<!-- 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚¨ãƒªã‚¢ -->
<div class="welcome-banner mb-4">
    <div class="d-flex align-items-center">
        {% if request.user.avatar %}
            <img src="{{ request.user.avatar.url }}" class="rounded-circle border" style="width: 100px; height: 100px; object-fit: cover;">
        {% else %}
            <!-- å†™çœŸãŒãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º -->
            <div class="avatar-wrapper me-3">ğŸ‘¤</div>
        {% endif %} 

        <div class="ms-3">
            <h2 class="greeting-text">
                {% if user.is_authenticated %}{{ user.username }}{% else %}ã‚²ã‚¹ãƒˆ{% endif %}ã•ã‚“ï¼
            </h2>
        </div>
    </div>
</div>

<!-- 2. å­¦ç¿’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆã‚¯ã‚¤ãƒƒã‚¯çµ±è¨ˆï¼‰ -->
<div class="row g-3 mb-4">
    <div class="col-6">
        <div class="stat-box">
            <p class="stat-label">å®Œäº†ã—ãŸæ¤œå®š</p>
            <p class="stat-value">24<small>ä»¶</small></p> <!-- {{ completed_count }} -->
        </div>
    </div>
    <div class="col-6">
        <div class="stat-box accent">
            <p class="stat-label">æ‰€æŒãƒãƒƒã‚¸</p>
            <p class="stat-value">{{ badges_count }}<small>å€‹</small></p> <!-- {{ badges_count }} -->
        </div>
    </div>
</div>

<!-- 3. ãƒãƒƒã‚¸å–å¾—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå‹•çš„ãƒ‡ãƒ¼ã‚¿ç‰ˆï¼‰ -->
<div class="content-box ranking-section mb-4">
    <div class="box-header">
        <h2 class="page-title">ğŸ† ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
        <span class="update-time">1æ™‚é–“ã”ã¨ã«æ›´æ–°</span>
    </div>
    
    <div class="ranking-container">
        {% if badge_ranking %}
            
            <!-- ğŸ¥‡ 1ä½ã®è¡¨ç¤ºï¼ˆãƒªã‚¹ãƒˆã®0ç•ªç›®ï¼‰ -->
            {% with first=badge_ranking.0 %}
            <div class="rank-card gold">
                <div class="rank-badge">1</div>
                <div class="user-img">ğŸ¥‡</div>
                <div class="rank-info">
                    <span class="user-name">{{ first.username }}</span> <!-- æ°åãªã‚‰ .name ã«å¤‰æ›´ -->
                    <span class="score">{{ first.badge_count }}æšç²å¾—</span>
                </div>
            </div>
            {% endwith %}

            <!-- ğŸ¥ˆ 2ä½ãƒ»ğŸ¥‰ 3ä½ã®è¡¨ç¤ºï¼ˆæ¨ªä¸¦ã³ã‚¨ãƒªã‚¢ï¼‰ -->
            <div class="row g-2 mb-3">
                <!-- 2ä½ï¼ˆãƒªã‚¹ãƒˆã®1ç•ªç›®ï¼‰ -->
                <div class="col-6">
                    {% if badge_ranking.1 %}
                        {% with second=badge_ranking.1 %}
                        <div class="rank-card silver">
                            <div class="rank-badge">2</div>
                            <div class="rank-info">
                                <span class="user-name text-truncate" style="max-width: 80px; display: block;">{{ second.username }}</span>
                                <span class="score text-muted small">{{ second.badge_count }}æš</span>
                            </div>
                        </div>
                        {% endwith %}
                    {% else %}
                        <!-- ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ç©ºæ  -->
                        <div class="rank-card border-dashed text-center text-muted py-3 small">é †ä½æœªç¢ºå®š</div>
                    {% endif %}
                </div>

                <!-- 3ä½ï¼ˆãƒªã‚¹ãƒˆã®2ç•ªç›®ï¼‰ -->
                <div class="col-6">
                    {% if badge_ranking.2 %}
                        {% with third=badge_ranking.2 %}
                        <div class="rank-card bronze">
                            <div class="rank-badge">3</div>
                            <div class="rank-info">
                                <span class="user-name text-truncate" style="max-width: 80px; display: block;">{{ third.username }}</span>
                                <span class="score text-muted small">{{ third.badge_count }}æš</span>
                            </div>
                        </div>
                        {% endwith %}
                    {% else %}
                        <div class="rank-card border-dashed text-center text-muted py-3 small">é †ä½æœªç¢ºå®š</div>
                    {% endif %}
                </div>
            </div>

        {% else %}
            <!-- ã¾ã èª°ã‚‚ãƒãƒƒã‚¸ã‚’ç²å¾—ã—ã¦ã„ãªã„å ´åˆ -->
            <div class="text-center py-4 text-muted small">
                ãƒ©ãƒ³ã‚­ãƒ³ã‚°é›†è¨ˆä¸­ã§ã™...
            </div>
        {% endif %}
    </div>
</div>

<!-- 4. é€šçŸ¥ ï¼† ãƒã‚¤ãƒªã‚¹ãƒˆ -->
<div class="dashboard-wrapper">
    <a href="#" class="content-box mb-3" style="text-decoration: none; color: inherit; display: block;">
        <h2>ğŸ”” å¾©ç¿’ãŒå¿…è¦ãªæ¤œå®š</h2>
        <div class="box-placeholder">
            ãƒ“ã‚¸ãƒã‚¹ãƒãƒŠãƒ¼åŸºç¤ï¼ˆæ®‹ã‚Š3æ—¥ï¼‰
        </div>
    </a>

    <a href="#" class="content-box" style="text-decoration: none; color: inherit; display: block;">
        <h2>ğŸ“ ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆ</h2>
        <div class="box-placeholder">
            ä¿å­˜ã—ãŸå‹•ç”»ã‚„ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
        </div>
    </a>
</div>

<style>
/* --- ãƒ‡ã‚¶ã‚¤ãƒ³CSS --- */
.welcome-banner {
    background: white;
    padding: 20px;
    border-radius: 24px;
    border: 1px solid #f0f0f0;
}
.avatar-wrapper {
    width: 60px; height: 60px;
    background: #e9ecef;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 30px;
}
.greeting-text { font-size: 1.1rem; font-weight: 800; margin: 0; }
.status-msg { font-size: 0.8rem; color: #777; margin: 0; }

.stat-box {
    background: white; padding: 15px; border-radius: 20px;
    text-align: center; border: 1px solid #f0f0f0;
}
.stat-box.accent { background: #fffaf5; border-color: #ff9800; }
.stat-label { font-size: 0.7rem; color: #999; margin-bottom: 2px; }
.stat-value { font-size: 1.6rem; font-weight: 900; color: #4caf50; margin: 0; }
.stat-box.accent .stat-value { color: #ff9800; }

.rank-card {
    background: white; border-radius: 16px; padding: 15px;
    position: relative; border: 1px solid #eee; margin-bottom: 10px;
    display: flex; align-items: center; gap: 15px;
}
.rank-badge {
    width: 28px; height: 28px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-weight: 900; font-size: 0.9rem; background: #eee;
}

.gold { border: 2px solid #FFD700; background: #fffdf0; }
.gold .rank-badge { background: #FFD700; color: white; }

.rank-list-item {
    display: flex; justify-content: space-between; padding: 6px 10px;
    font-size: 0.85rem; border-bottom: 1px solid #f9f9f9;
}
</style>
{% endblock %}