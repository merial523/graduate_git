{% extends base_template %}
{% block content %}
<div class="container py-4" style="max-width: 1100px;">
    
    <!-- 1. ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->
    <nav class="mb-2">
        <a href="{% url 'courses:staff_course_list' %}" class="text-decoration-none small" style="color: #0d6efd;">ç ”ä¿®ä¸€è¦§</a>
        <span class="small text-muted"> / {{ module.course.subject }}</span>
    </nav>

    <!-- 2. ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ« -->
    <h1 class="fw-bold mb-4" style="font-size: 2rem;">{{ module.title }}</h1>

    <div class="row g-4">
        <!-- å·¦å´ï¼šãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="col-lg-7">
            <!-- å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4 bg-dark">
                {% if module.video %}
                    <video controls class="w-100" style="max-height: 450px;">
                        <source src="{{ module.video.url }}" type="video/mp4">
                    </video>
                {% else %}
                    <div class="text-white d-flex align-items-center justify-content-center" style="height: 350px;">
                        <p class="mb-0">å‹•ç”»æº–å‚™ä¸­</p>
                    </div>
                {% endif %}
            </div>

            <!-- ç ”ä¿®ãƒ†ã‚­ã‚¹ãƒˆ -->
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-3"><i class="bi bi-book me-2"></i>ç ”ä¿®ãƒ†ã‚­ã‚¹ãƒˆãƒ»è¦ç´„</h5>
                    <hr>
                    <div class="training-content" style="line-height: 1.7; color: #333;">
                        {{ module.content_text|safe|default:"ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚" }}
                    </div>
                </div>
            </div>
        </div>

        <!-- å³å´ï¼šã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div class="col-lg-5">
            <!-- å­¦ç¿’æ™‚é–“ã®ç›®å®‰ï¼ˆç”»åƒã«è¿‘ã„ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ -->
            <div class="card border-0 shadow-sm rounded-4 mb-3 text-center text-white" style="background-color: #0d6efd;">
                <div class="card-body py-3">
                    <div class="small opacity-75">å­¦ç¿’æ™‚é–“ã®ç›®å®‰</div>
                    <div class="display-5 fw-bold">{{ module.estimated_time }}åˆ†</div>
                </div>
            </div>

            <!-- ç†è§£åº¦ãƒã‚§ãƒƒã‚¯ï¼ˆç”»åƒã«è¿‘ã„ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ -->
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-4">ğŸ’¡ ç†è§£åº¦ãƒã‚§ãƒƒã‚¯</h5>
                    
                    {% for example in module.examples.all %}
                    <div class="example-section mb-4 pb-4 {% if not forloop.last %}border-bottom{% endif %}">
                        <p class="text-primary fw-bold small mb-1">ä¾‹é¡Œ {{ forloop.counter }}</p>
                        <p class="fw-bold mb-3" style="font-size: 1.05rem;">{{ example.text }}</p>
                        
                        <div class="d-grid gap-2">
                            {% for choice in example.choices.all %}
                            <button class="btn btn-outline-secondary text-start py-2 px-3 small-choice" 
                                    style="font-size: 0.9rem; border-color: #dee2e6;"
                                    onclick="checkAnswer(this, {{ choice.is_correct|yesno:'true,false' }})">
                                {{ choice.text }}
                            </button>
                            {% endfor %}
                        </div>

                        <!-- æ­£è§£ãƒ»è§£èª¬ã‚¨ãƒªã‚¢ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
                        <div class="explanation-area d-none mt-3 p-3 rounded-3 border bg-light" style="font-size: 0.85rem;">
                            <div class="result-msg fw-bold mb-1"></div>
                            <div class="text-secondary"><strong>ã€è§£èª¬ã€‘</strong><br>{{ example.explanation }}</div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted small">ã“ã®ç ”ä¿®ã«ä¾‹é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function checkAnswer(button, isCorrect) {
        const parent = button.closest('.example-section');
        const explanation = parent.querySelector('.explanation-area');
        const resultMsg = parent.querySelector('.result-msg');
        const allButtons = parent.querySelectorAll('.small-choice');

        // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
        allButtons.forEach(btn => btn.classList.add('disabled'));

        if (isCorrect) {
            button.classList.replace('btn-outline-secondary', 'btn-success');
            button.classList.add('text-white');
            resultMsg.innerHTML = '<span class="text-success">âœ¨ æ­£è§£ï¼</span>';
        } else {
            button.classList.replace('btn-outline-secondary', 'btn-danger');
            button.classList.add('text-white');
            resultMsg.innerHTML = '<span class="text-danger">âŒ æ®‹å¿µï¼</span>';
        }

        // è§£èª¬ã‚’è¡¨ç¤º
        explanation.classList.remove('d-none');
    }
</script>

<style>
    /* å…¨ä½“ãƒ•ã‚©ãƒ³ãƒˆã®èª¿æ•´ */
    body { background-color: #f0f2f5; font-family: sans-serif; }
    
    /* é¸æŠè‚¢ãŒç¸¦ã«é•·ããªã‚Šã™ããªã„ã‚ˆã†ã«èª¿æ•´ */
    .small-choice {
        transition: all 0.2s;
        border-radius: 10px;
    }
    .small-choice:hover:not(.disabled) {
        background-color: #f8f9fa;
        border-color: #0d6efd;
        color: #0d6efd;
    }
    
    /* ç ”ä¿®ãƒ†ã‚­ã‚¹ãƒˆå†…ã®ãƒªã‚¹ãƒˆãªã©ã®ä½™ç™½ */
    .training-content ul { padding-left: 1.2rem; }
    .training-content p { margin-bottom: 1rem; }
</style>
{% endblock %}