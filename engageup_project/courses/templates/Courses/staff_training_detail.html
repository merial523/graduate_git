{% extends base_template %}
{% block content %}
<div class="container py-5">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'courses:staff_course_list' %}">ç ”ä¿®ä¸€è¦§</a></li>
            <li class="breadcrumb-item active">{{ module.course.subject }}</li>
        </ol>
    </nav>
    <h2 class="fw-bold mb-4">{{ module.title }}</h2>

    <div class="row g-4">
        <!-- å·¦å´ï¼šå‹•ç”»ã‚¨ãƒªã‚¢ -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
                {% if module.video %}
                    <video controls class="w-100" style="background: #000; max-height: 500px;">
                        <source src="{{ module.video.url }}" type="video/mp4">
                        ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
                    </video>
                {% else %}
                    <div class="bg-dark text-white d-flex align-items-center justify-content-center" style="height: 400px;">
                        <p>å‹•ç”»æº–å‚™ä¸­</p>
                    </div>
                {% endif %}
            </div>

            <!-- ä¸‹ï¼šAIè¦ç´„ãƒ†ã‚­ã‚¹ãƒˆ -->
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-3 border-bottom pb-2">ğŸ“– ç ”ä¿®ãƒ†ã‚­ã‚¹ãƒˆãƒ»è¦ç´„</h5>
                    <div class="training-content" style="line-height: 1.8;">
                        <!-- AIãŒç”Ÿæˆã—ãŸHTMLã‚’å®‰å…¨ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã« |safe ã‚’ä½¿ã„ã¾ã™ -->
                        {{ module.content_text|safe|default:"ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚" }}
                    </div>
                </div>
            </div>
        </div>

        <!-- å³å´ï¼šä¾‹é¡Œãƒ»ã‚µã‚¤ãƒ‰æƒ…å ± -->
        <div class="col-lg-4">
            <!-- å­¦ç¿’æ™‚é–“ç›®å®‰ -->
            <div class="card border-0 shadow-sm rounded-4 mb-4 bg-primary text-white">
                <div class="card-body text-center py-3">
                    <small>å­¦ç¿’æ™‚é–“ã®ç›®å®‰</small>
                    <div class="h3 m-0 fw-bold">{{ module.estimated_time }}åˆ†</div>
                </div>
            </div>

            <!-- âœï¸ ä¾‹é¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-4 border-bottom pb-2">ğŸ’¡ ç†è§£åº¦ãƒã‚§ãƒƒã‚¯</h5>
                    
                    {% for example in module.examples.all %}
                    <div class="mb-5">
                        <p class="fw-bold small text-primary mb-2">ä¾‹é¡Œ {{ forloop.counter }}</p>
                        <p class="mb-3 fw-bold">{{ example.text }}</p>
                        
                        <div class="list-group mb-3">
                            {% for choice in example.choices.all %}
                            <button class="list-group-item list-group-item-action small py-2 example-choice" 
                                    onclick="checkExample(this, {{ choice.is_correct|yesno:'true,false' }})">
                                {{ choice.text }}
                            </button>
                            {% endfor %}
                        </div>

                        <!-- è§£èª¬ã‚¨ãƒªã‚¢ï¼ˆæœ€åˆã¯éš ã—ã¦ãŠãï¼‰ -->
                        <div class="explanation-box d-none mt-2 p-3 bg-light rounded-3 small border">
                            <strong>ã€è§£èª¬ã€‘</strong><br>
                            {{ example.explanation }}
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted small">ã“ã®ç ”ä¿®ã«ä¾‹é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ä¾‹é¡Œã®æ­£è§£ãƒã‚§ãƒƒã‚¯ã¨è§£èª¬è¡¨ç¤ºã‚’è¡Œã†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    function checkExample(button, isCorrect) {
        const parent = button.closest('.mb-5');
        const explanation = parent.querySelector('.explanation-box');
        const allChoices = parent.querySelectorAll('.example-choice');

        // ä»–ã®é¸æŠè‚¢ã‚’ã‚¯ãƒªãƒƒã‚¯ä¸å¯ã«ã™ã‚‹
        allChoices.forEach(btn => btn.classList.add('disabled'));

        if (isCorrect) {
            button.classList.add('bg-success', 'text-white', 'border-success');
            button.innerHTML += ' âœ¨ æ­£è§£ï¼';
        } else {
            button.classList.add('bg-danger', 'text-white', 'border-danger');
            button.innerHTML += ' âŒ æ®‹å¿µï¼';
        }

        // è§£èª¬ã‚’è¡¨ç¤º
        explanation.classList.remove('d-none');
    }
</script>

<style>
    .training-content ul { padding-left: 1.2rem; }
    .example-choice { font-size: 0.9em; border-radius: 8px !important; margin-bottom: 5px; }
</style>
{% endblock %}