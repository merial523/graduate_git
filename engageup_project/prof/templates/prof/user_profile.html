{% extends base_template %}
{% load static %}

{% block title %}ãƒã‚¤ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« | EngageUp{% endblock %}

{% block content %}
<div class="user-management-container pb-5">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ -->
    <div class="mb-4">
        <h1 class="page-title text-dark m-0 fw-800">ãƒã‚¤ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h1>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ -->
    <div class="admin-card border-0 shadow-sm mb-5 rounded-5 bg-white overflow-hidden">
        <div class="card-body p-4 p-md-5">
            <div class="d-flex flex-column flex-md-row align-items-center align-items-md-start gap-4">
                
                <!-- å†™çœŸã‚¨ãƒªã‚¢ï¼šå¤§ããªä¸¸ã¿ã¨å½±ã§å¼·èª¿ -->
                <div class="profile-avatar-wrapper">
                    {% if request.user.avatar %}
                        <img src="{{ request.user.avatar.url }}" class="profile-avatar-img shadow-sm">
                    {% else %}
                        <div class="profile-avatar-placeholder shadow-sm">
                            <span class="material-icons">person</span>
                        </div>
                    {% endif %}
                </div>
                
                <!-- æƒ…å ±ã‚¨ãƒªã‚¢ -->
                <div class="flex-grow-1 text-center text-md-start w-100">
                    <div class="mb-3">
                        <h2 class="fw-800 text-dark mb-1">{{ request.user.username }}</h2>
                        <span class="badge bg-soft-blue text-primary rounded-pill px-3">
                            ä¼šå“¡ç•ªå·: {{ request.user.member_num|default:"---" }}
                        </span>
                    </div>
                    
                    <!-- è‡ªå·±ç´¹ä»‹ï¼šãƒ¡ãƒ¢å¸³ã®ã‚ˆã†ãªè³ªæ„Ÿ -->
                    <div class="bio-box p-3 rounded-4 mb-4">
                        <label class="fw-800 small text-muted d-flex align-items-center gap-1 mb-2">
                            <span class="material-icons size-16">notes</span>
                            å‚™è€ƒãƒ»è‡ªå·±ç´¹ä»‹
                        </label>
                        <p class="small mb-0 text-dark" style="line-height: 1.6;">
                            {{ request.user.remarks|default:"è‡ªå·±ç´¹ä»‹ãŒæœªè¨˜å…¥ã§ã™ã€‚ç·¨é›†ã‹ã‚‰å…¥åŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼"|linebreaksbr }}
                        </p>
                    </div>
                    
                    <!-- ç·¨é›†ãƒœã‚¿ãƒ³ï¼šã‚«ãƒ—ã‚»ãƒ«å‹ -->
                    <div class="d-grid d-md-block">
                        <a href="{% url 'prof:profile_edit' %}" class="btn btn-outline-primary rounded-pill px-4 fw-800 shadow-sm">
                            <span class="material-icons size-18 me-1">settings</span>
                            ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç²å¾—ãƒãƒƒã‚¸ã‚¨ãƒªã‚¢ï¼šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚±ãƒ¼ã‚¹ã®ã‚ˆã†ãªæ¼”å‡º -->
    <div class="badge-section">
        <h3 class="h5 fw-800 text-dark d-flex align-items-center gap-2 mb-4">
            <span class="material-icons text-warning">workspace_premium</span>
            ç²å¾—ã—ãŸç§°å·ï¼ˆãƒãƒƒã‚¸ï¼‰
        </h3>

        {% if passed_statuses %}
            <div class="row row-cols-2 row-cols-sm-3 row-cols-md-5 g-3">
                {% for status in passed_statuses %}
                    {% if status.exam.badge %}
                        <div class="col">
                            <div class="badge-item-card h-100 text-center p-3 shadow-sm border-0 bg-white rounded-4">
                                <div class="badge-icon-container mb-2">
                                    {% if status.exam.badge.icon %}
                                        <img src="{{ status.exam.badge.icon.url }}" class="img-fluid">
                                    {% else %}
                                        <span class="material-icons text-warning" style="font-size: 40px;">stars</span>
                                    {% endif %}
                                </div>
                                <p class="extra-small fw-800 text-dark mb-0 line-clamp-2">
                                    {{ status.exam.badge.name }}
                                </p>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>

        {% else %}
            <!-- ãƒ‘ã‚¿ãƒ¼ãƒ³Bï¼šãƒãƒƒã‚¸ãŒãªã„å ´åˆï¼ˆã‚°ãƒªãƒƒãƒ‰ã®æ ã‚’ä½¿ã‚ãšã€ç‹¬ç«‹ã—ãŸå…¨å¹…è¡¨ç¤ºã«ã™ã‚‹ï¼‰ -->
            <div class="admin-card bg-light border-dashed p-5 rounded-5 w-100 text-center mt-3">
                <span class="material-icons text-muted opacity-25" style="font-size: 48px;">military_tech</span>
                <p class="text-muted small mt-2 mb-0">
                    ã¾ã ç²å¾—ã—ãŸãƒãƒƒã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
                    æ¤œå®šã«åˆæ ¼ã—ã¦ãƒãƒƒã‚¸ã‚’é›†ã‚ã¾ã—ã‚‡ã†ï¼
                </p>
            </div>
        {% endif %}

                <!-- <h4>ç²å¾—ç§°å·ï¼ˆãƒãƒƒã‚¸ï¼‰</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 15px;">
            <h4 class="fw-bold mb-3">ğŸ–ï¸ ç²å¾—ç§°å·</h4>
            <div class="row row-cols-2 row-cols-sm-3 row-cols-md-5 g-3">
                {% for status in passed_statuses %}
                    {% if status.exam.badge %}
                        <div style="border: 1px solid #ccc; padding: 10px; text-align: center; width: 100px;">
                            {% if status.exam.badge.icon %}
                                <img src="{{ status.exam.badge.icon.url }}" style="width: 50px;">
                            {% endif %}
                            <p style="font-size: 10px; margin-top: 5px;">{{ status.exam.badge.name }}</p>
                        <div class="col">
                            <div class="card h-100 text-center border-0 bg-light py-2">
                                <div class="mb-1">
                                    {% if status.exam.badge.icon %}
                                        <img src="{{ status.exam.badge.icon.url }}" style="height: 50px; width: 50px; object-fit: contain;">
                                    {% else %}
                                        <div style="font-size: 30px;">ğŸ–ï¸</div>
                                    {% endif %}
                                </div>
                                <p class="small fw-bold mb-0">{{ status.exam.badge.name }}</p>
                            </div>
                        </div>
                    {% endif %}
                {% empty %}
                    <p>ã¾ã ç²å¾—ã—ãŸãƒãƒƒã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                {% endfor %}
            </div>
        </div> -->
    </div>
</div>

<style>
    /* ã”æŒ‡å®šã®ã‚¿ã‚¤ãƒˆãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
    .page-title {
        font-size: 1.4rem;
        border-left: 5px solid var(--primary-color);
        padding-left: 15px;
    }

    .fw-800 { font-weight: 800 !important; }
    .size-16 { font-size: 16px; }
    .size-18 { font-size: 18px; }
    .extra-small { font-size: 0.75rem; }
    .bg-soft-blue { background-color: rgba(118, 177, 157, 0.1); }

    /* ã‚¢ãƒã‚¿ãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .profile-avatar-wrapper {
        flex-shrink: 0;
    }
    .profile-avatar-img, .profile-avatar-placeholder {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid #fff;
    }
    .profile-avatar-placeholder {
        background-color: var(--bg-color);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary-color);
    }
    .profile-avatar-placeholder .material-icons { font-size: 60px; }

    /* è‡ªå·±ç´¹ä»‹ãƒœãƒƒã‚¯ã‚¹ */
    .bio-box {
        background-color: #fdfaf5;
        border: 1px solid #f0ece4;
        text-align: left;
    }

    /* ãƒãƒƒã‚¸ã‚¢ã‚¤ãƒ†ãƒ  */
    .badge-item-card {
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 1px solid rgba(0,0,0,0.03) !important;
    }
    .badge-item-card:hover {
        transform: scale(1.05) translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.08) !important;
    }
    .badge-icon-container {
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .badge-icon-container img {
        max-height: 60px;
        filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }

    /* å¢ƒç•Œç·šãƒ‡ã‚¶ã‚¤ãƒ³ */
    .border-dashed { border: 2px dashed #ddd !important; }

    /* ãƒ†ã‚­ã‚¹ãƒˆã®2è¡Œçœç•¥ */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
{% endblock %}